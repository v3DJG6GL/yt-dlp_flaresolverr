version: "3.8"

services:
  flaresolverr:
    image: ghcr.io/flaresolverr/flaresolverr:latest
    container_name: flaresolverr
    network_mode: host
    environment:
      - LOG_LEVEL=info
      - TZ=Europe/Zurich
      - PORT=8191
    restart: unless-stopped

  mitmproxy:
    image: mitmproxy/mitmproxy:latest
    container_name: mitmproxy-solver
    network_mode: host
    volumes:
      # Use ${PWD} to dynamically insert the current directory path
      - ${PWD}/yt-dlp_flaresolverr.py:/home/mitmproxy/yt-dlp_flaresolverr.py
    command: >
      sh -c "pip install requests && 
             mitmdump -s /home/mitmproxy/yt-dlp_flaresolverr.py --listen-port 8192"
    depends_on:
      - flaresolverr
    restart: unless-stopped
